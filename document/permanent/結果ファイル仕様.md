## 結果ファイル保存仕様

本ファイルでは、DP 期待値計算結果を外部ファイルに保存するフォーマットを定義する。

### 1. 保存ディレクトリ
* `results/`下の`cache/`フォルダ  に保存する。
* ファイル名は `n{n}_acc{r}.txt` 形式 (例: `n100_acc3.txt`)。

### 2. ファイル構造
| 行番号 | 内容 | 例 |
|-------|------|----|
| 1 | 試合残数 `n` の宣言 | `n=100` |
| 2 | アカウント数 `r` の宣言 | `r=3` |
| 3 | (空行) |  |
| 4 | ヘッダ | `account1, account2, account3, expectation, best_action` |
| 5~ | データ行 | `1700, 1700, 1700, 1750, 1` |

### 3. データ行の詳細
1. アカウント毎のレートは降順 (高→低) で列挙する。
2. `expectation` は対象状態で残り `n` 試合からプレイしたときの最終最高レートの期待値。
3. `best_action` は `best_action()` が返すインデックス。`None` は空文字で表す。

### 4. 書き込みポリシー
* ファイルが存在しない場合はヘッダ込みで新規作成。
* 既存ファイルに同一レート列のデータがあれば上書きせずスキップする (追記のみ)。

### 5. 読み込みポリシー
* `src/core/result_cache.load_cache()` で読み込み、キーを `(ratings_tuple)`、値を `(expectation, best_action)` の辞書で返す。
* 行 1〜3 はメタ情報として無視し、4 行目以降を CSV として解釈する。

---

この仕様は `src/core/result_cache.py` と `README.md` の「計算結果の保存と再利用」セクションでも解説されている。 