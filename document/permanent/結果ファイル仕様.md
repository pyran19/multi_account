## 結果ファイル保存仕様

本ファイルでは、DP 期待値計算結果を外部ファイルに保存するフォーマットを定義する。

### 1. 保存ディレクトリ
* `results/`下の`cache/`フォルダに保存する。
* ファイル名は `n{n}_acc{r}.txt` 形式 (例: `n100_acc3.txt`)。

### 2. ファイル構造
| 行番号 | 内容 | 例 |
|-------|------|----|
| 1 | 試合残数 `n` の宣言 | `n=100` |
| 2 | アカウント数 `r` の宣言 | `r=3` |
| 3 | (空行) |  |
| 4 | ヘッダ | `account1, account2, account3, expectation, best_action` |
| 5~ | データ行 | `0, 0, 0, 3, 1` |

### 3. データ行の詳細
1. アカウント毎のレートは降順 (高→低) で列挙する。整数レートで書く。
2. `expectation` は対象状態で残り `n` 試合からプレイしたときの最終最高レートの期待値（整数レート表現）。
3. `best_action` は `best_action()` が返すインデックス。`None` は空文字で表す。

### 4. 書き込みポリシー
* ファイルが存在しない場合はヘッダ込みで新規作成。
* 既存ファイルに同一レート列のデータがあれば上書きせずスキップする (追記のみ)。

### 5. 読み込みポリシー
* `src/core.result_cache.load_cache()` で読み込み、キーを `(浮動小数点ratings_tuple)`、値を `(浮動小数点expectation, best_action)` のタプルを値とする辞書で返す。
* 行 1〜4 はメタ情報として無視し、5 行目以降を CSV として解釈する。

### 6. 整数レート表現
* 全てのレート値は整数レートに変換して保存される。
* 変換式: `int_rating = round((float_rating - μ) / d)`
  - μ: 適正レート (デフォルト 1500)
  - d: レート変動幅 (デフォルト 16)
* 例:
  - 1500 → 0 (適正レート)
  - 1516 → 1 (1勝)
  - 1484 → -1 (1敗)

---

この仕様は `src/core/result_cache.py` と `README.md` の「5. 計算結果の保存と再利用」および「6. レートの整数化」セクションでも解説されている。 