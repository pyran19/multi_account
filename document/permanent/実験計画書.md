# 多アカウント戦略分析 実験計画書

## 1. 実験目的と前提

### 1.1 実験目的
多アカウント戦略における最適なレート配分と残り試合数の関係性を定量的に分析し、2番目仮説の検証を行う。

### 1.2 前提条件
- 全ての(n,v)パターンを網羅的に検証するのではなく、主要な傾向を把握することを目的とする
- 検証手法として、アカウント毎に色分けしたx-Pプロットを用いる

## 2. 実験フェーズ

### 2.1 フェーズ1: 2番目仮説の検証
#### 目的
2番目アカウントの影響が最も大きいという仮説の数値的検証

#### 実験手法
- 等間隔条件でのパラメータ検証
- 1パラメータずつの変更による影響度測定

#### パラメータ設定
- **等間隔条件**: v₁=v₀, v₂=v₀+dv, v₃=v₀+2dv, ..., vᵣ=v₀+(r-1)dv
- **制御パラメータ**: 
  - ベースラインレート v₀
  - レート差 dv
  - 残り試合数 n

#### 実施項目
1. **n-Pプロット**: 残り試合数nを変更しての影響測定
2. **v₀-Pプロット**: ベースラインレートv₀を変更しての影響測定
3. **dv-Pプロット**: レート差dvを変更しての影響測定（優先度低）

### 2.2 フェーズ2: 定量評価
#### 実施条件
フェーズ1の結果を受けて実施

#### 評価項目
1. 残り試合数nの増加による期待値変化量
2. 最適なvの分布形状の特定
3. i番目アカウントの最終レート期待値に対する影響度関数
4. アカウント数r（dim(v)）の影響度評価

## 3. データ管理仕様

### 3.1 x-Pプロット データフォーマット
#### CSV形式
```
x,v1,P1,P2,P3,...,Pr
```
- x: 変更パラメータ（n, v₀, dv等）
- v1: 現在の最大レート（各状態での最高アカウントのレート）
- P1～Pr: 各アカウントの期待レート（実数値）

#### プロット仕様
- **縦軸**: P1-v1, P2-v1, P3-v1, ... （期待値と最大レートの差分）
- **横軸**: 変更パラメータ（n, v₀, dv等）
- **基準線**: y=0 の水平線（打ち切り基準線）を表示
- **解釈**: 
  - 正の値: そのアカウントを選択することで、打ち切りより高いレートが期待できる
  - 負の値: そのアカウントを選択するより、打ち切りの方が有利
  - ゼロ: 参加と打ち切りが同等

#### ファイル命名規則
- **CSVファイル**: `xp_{date:yyyymmddHHMMSS}.csv`
- **設定ファイル**: `任意名.json`
- **グラフ画像**: `xp_{date:yyyymmddHHMMSS}.png`

### 3.2 設定ファイル仕様（JSON）
#### 必須項目
- csvファイルへの参照
- グラフ画像ファイルへの参照
- アカウント数r
- xの種類（n, v₀, dv等）
- 固定パラメータの値

#### 例：n-Pプロット設定
```json
{
  "csv_ref": "xp_20241201120000.csv",
  "graph_ref": "xp_20241201120000.png", 
  "account_count": 5,
  "x_type": "n",
  "fixed_params": {
    "v_rates": [1500, 1600, 1700, 1800, 1900]
  }
}
```

#### 例：v₀-Pプロット設定
```json
{
  "csv_ref": "xp_data20241201130000.csv",
  "graph_ref": "xp_data20241201130000.png",
  "account_count": 5, 
  "x_type": "v0",
  "fixed_params": {
    "n": 50,
    "dv": 100
  }
}
```

### 3.3 データ処理フロー
1. xの候補値と固定パラメータを入力
2. 各x値に対応する(n,v)組み合わせを生成
3. 各組み合わせで期待値計算を実行
4. 最大レート（v1）と各アカウントの期待値（P1～Pr）を記録
5. CSV形式でデータ出力（x, v1, P1, P2, ..., Prの順）
6. グラフ生成（縦軸：Pi-v1）・画像保存
7. JSON設定ファイルに参照情報を記録

### 3.4 期待値計算仕様
P1, P2, ..., Prの算出には、各アカウントのレートが±1変動した場合の期待値が必要
- 例：(n,v)のP₁算出 → (n-1, v₁±1, v₂, ..., vᵣ)の期待値を使用
- 全アカウント分を効率的に一括計算する関数を実装

## 4. 実装計画

### 4.1 優先度1: フェーズ1実験システム
1. x-Pプロット生成システム
2. データ出力・管理システム  
3. n-Pプロット実装

### 4.2 優先度2: フェーズ1完了
1. v₀-Pプロット実装
2. dv-Pプロット実装（必要に応じて）
3. 結果分析・2番目仮説の検証

### 4.3 優先度3: フェーズ2実装
フェーズ1の結果を基に、主要影響パラメータに特化した詳細分析

## 5. 期待される成果

### 5.1 フェーズ1成果
- 2番目仮説の数値的検証結果
- 各パラメータの影響度の定量化
- 主要影響パラメータの特定

### 5.2 フェーズ2成果  
- 最適アカウント数の提案
- 最適レート分布戦略の提案
- パラメータ間の相互作用の解明
