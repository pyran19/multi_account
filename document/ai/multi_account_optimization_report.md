# 複数アカウント運用によるレート最大化戦略の分析

## 1. はじめに

本レポートは、複数アカウントを運用し、シーズン終了時における最も高いアカウントのレート期待値を最大化する問題について考察します。具体的には、提供されているコマンドラインインターフェース `src/cli.py dp` を用いて実施した実験結果をまとめ、最適な戦略について分析します。

## 2. 実験方法

### 使用ツール
`src/cli.py dp`

### 基本パラメータ (デフォルト値)
実験では、以下の基本パラメータをデフォルト値として使用しました。
*   `mu` (適正レート): 1500
*   `rating_step` (レート変動幅): 16
*   `k_coeff` (勝率係数): `math.log(10) / 1600` (約 0.001439)

### 実験ケース
以下の条件で実験を行いました。
*   **アカウント数:** 1, 2, 3
*   **残り試合数 (`n`):** 1, 2, 5, 10 を中心に実験。
*   **初期レート:**
    *   全アカウントが同レート (1500) の場合
    *   アカウント間でレート差がある場合 (例: `[1532, 1500]`)

## 3. 実験結果と考察

### 3.1. 残り試合数 `n` の影響

単一アカウントの場合、残り試合数 `n=1` で初期レートが適正レート `mu` と一致する場合、「即時終了」が最適行動となることが観測されました。これは、1試合行った場合のレート変動の期待値が0であり、現状維持が合理的であるためです。しかし、`n > 1` となると、レート上昇の機会が増えるため、試合を行う方が期待値は `n` と共に上昇する傾向が見られました。

複数アカウントの場合も同様に、最終レートの期待値は `n` と共に上昇する傾向が確認できました。

**表1: 残り試合数 `n` とアカウント数に応じた最終レート期待値の変化**

| アカウント数 | 初期レート     | 残り試合数 (n) | 最終レート期待値 | 最適アクション   |
|--------------|----------------|----------------|--------------------|--------------------|
| 1            | [1500]         | 1              | 1500.00            | 今すぐ終了         |
| 1            | [1500]         | 10             | 1504.16            | アカウント0で潜る    |
| 2            | [1500, 1500]   | 1              | 1508.00            | アカウント0で潜る    |
| 2            | [1500, 1500]   | 10             | 1519.92            | アカウント0で潜る    |

*考察:*
*   単一アカウント、`n=1`、初期レート1500のケースでは「今すぐ終了」が最適でした。
*   それ以外のケースでは、残り試合数が多いほど期待値は高くなる傾向にあります。
*   複数アカウントの場合、`n=1`でも試合をする方が期待値が高くなっています。これは、複数のアカウントのいずれかで良い結果を出せば良いため、試行回数を増やすメリットがあると考えられます。

### 3.2. アカウント数の影響

アカウント数が多いほど、最も高いアカウントの最終レート期待値は上昇する傾向が見られました。これは、試行回数を増やせること、また、複数のアカウントのうち最も良い結果を選択できることによる効果と考えられます。

ただし、アカウントを追加することによる期待値の上昇分は、アカウント数が増えるにつれて逓減する可能性があります。例えば、1アカウントから2アカウントへの増加による期待値の上昇幅と、2アカウントから3アカウントへの増加による上昇幅を比較すると、後者の方が小さいケースが見られました。

**表2: 残り試合数 `n=5` におけるアカウント数と最終レート期待値の関係**

| 初期レート             | 残り試合数 (n) | アカウント数 | 最終レート期待値 |
|------------------------|----------------|--------------|--------------------|
| [1500]                 | 5              | 1            | 1501.56            |
| [1500, 1500]           | 5              | 2            | 1515.04            |
| [1500, 1500, 1500]     | 5              | 3            | 1518.27            |

*考察:*
*   アカウント数を増やすことで、最終レートの期待値は上昇します。
*   1アカウントから2アカウントにした場合の上昇幅 (1515.04 - 1501.56 = 13.48) に対し、2アカウントから3アカウントにした場合の上昇幅 (1518.27 - 1515.04 = 3.23) は小さくなっています。これは、アカウント追加による限界的な期待値上昇が逓減することを示唆しています。

### 3.3. 初期レート分布の影響

アカウント間で初期レートに差がある場合、必ずしも最もレートが高いアカウントでプレイし続けるのが最適とは限らない、という興味深い結果が得られました。

実験ケースとして、2アカウント、残り試合数 `n=5`、初期レートが `[1532, 1500]` の場合を考えます。この場合、レートが低いアカウント1 (初期レート1500) でプレイする方が、最終的な最高レートの期待値が高くなるという結果が出ました。

**表3: 初期レートに差がある場合の最適アクション**

| アカウント数 | 初期レート     | 残り試合数 (n) | 最終レート期待値 | 最適アクション   |
|--------------|----------------|----------------|--------------------|--------------------|
| 2            | [1532, 1500]   | 5              | 1535.43            | アカウント1で潜る    |

*考察:*
この結果は直感に反するように思えるかもしれません。しかし、これは戦略的な意味合いを持つと考えられます。
*   **リスク分散とポテンシャルの最大化:** レートが高いアカウント (1532) は既に比較的高レートであり、ここからさらにレートを大幅に上げるのは難しいかもしれません。一方で、レートが低いアカウント (1500) は、適正レート `mu=1500` 付近であるため、勝率が0.5と（レートが高いアカウントに比べて）高く、レート上昇の機会を捉えやすい（または敗北時のレート減少リスクが許容できる範囲で、より多くの試合を試行できる）可能性があります。
*   **全体最適:** 個々のアカウントの勝率だけでなく、最終的に「いずれかのアカウントの最高レート」を最大化するという目的から、低いレートのアカウントを引き上げ、そのアカウントが高いレートに到達する可能性に賭ける方が、全体としての期待値を高める場合があることを示唆しています。レートが高いアカウントで負けた場合の大幅なレートダウンを避けつつ、低いアカウントでアップサイドを狙う戦略と言えます。

### 3.4. 最適アクション「即時終了」について

最適アクションとして「即時終了」が選択されたのは、前述の通り、単一アカウント、残り試合数 `n=1`、かつ初期レートが適正レート `mu` (この実験では1500) と一致する特殊なケースでのみ観測されました。

複数アカウント体制では、たとえ残り試合数が `n=1` であっても、いずれかのアカウントで試合を行う方が期待値を高める結果となりました。これは、複数の試行機会があるため、いずれかのアカウントでレートが上昇する可能性を追求する方が有利であることを意味します。

## 4. 計算コストについて

`src/cli.py dp` は動的計画法 (DP) に基づいて最適戦略を計算していると考えられます。DPの性質上、状態空間の大きさ、特に残り試合数 `n` の増加に伴い、計算量が指数関数的に増加する傾向があります。

今回の実験でも、`n` が大きくなるにつれて計算時間が顕著に増加することが確認されました。`src/cli.py dp` には計算結果をキャッシュする機構が存在するようですが、これは一度計算した結果を再利用するものであり、本質的な計算量のオーダーを削減するものではありません。したがって、非常に大きな `n` や多数のアカウント数での詳細な実験には、計算時間という実際的な制約が存在します。

## 5. 結論

本レポートの実験結果から、以下の結論が得られました。

*   **複数アカウント運用の有効性:** 複数アカウントを運用することは、単一アカウントの場合と比較して、適切戦略のもとでシーズン終了時の最高レートの期待値を高める上で有効であると言えます。
*   **戦略の複雑性:** 最適な戦略は、残り試合数 (`n`)、アカウント数、そして各アカウントの現在のレート分布に複雑に依存します。
*   **低レートアカウント活用の可能性:** 特に注目すべきは、アカウント間でレート差がある場合に、必ずしも最高レートのアカウントでプレイし続けるのではなく、あえてレートの低いアカウントでプレイする戦略が最適解となり得る点です。これは、リスク管理とアップサイドポテンシャルのバランスを取る高度な戦略と言えます。
*   **「即時終了」戦略の限定性:** 「即時終了」が最適となるのは、非常に限定された条件下（単一アカウント、`n=1`、初期レート=適正レート）のみでした。

今後の展望としては、より多くの試合数やアカウント数での分析、異なる勝率モデル（例えば、レート差だけでなく、プレイヤーの調子などを加味したモデル）での検証などが考えられます。しかし、これらを進める上では、前述の計算コストとのバランスを考慮する必要があります。より効率的なアルゴリズムや近似解法の導入も、将来的な研究テーマとなり得るでしょう。
